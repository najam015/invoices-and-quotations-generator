<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoice Generator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding-top: 20px;
        }
        .card {
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
            border: 1px solid rgba(0, 0, 0, 0.125);
            margin-bottom: 20px;
        }
        .card-header {
            background-color: #f8f9fa;
            border-bottom: 1px solid rgba(0, 0, 0, 0.125);
            font-weight: 600;
        }
        .invoice-preview {
            background-color: white;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin: 0 auto;
        }
        .invoice-header {
            border-bottom: 2px solid #000;
            padding-bottom: 20px;
            margin-bottom: 20px;
        }
        .invoice-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        .invoice-table {
            width: 100%;
            border-collapse: collapse;
        }
        .invoice-table th {
            background-color: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            padding: 12px 15px;
            text-align: left;
        }
        .invoice-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #dee2e6;
        }
        .invoice-totals {
            width: 300px;
            margin-left: auto;
            margin-top: 20px;
        }
        .invoice-totals table {
            width: 100%;
        }
        .invoice-totals td {
            padding: 8px 10px;
        }
        .invoice-totals tr:last-child {
            font-weight: bold;
            border-top: 1px solid #dee2e6;
        }
        .invoice-footer {
            margin-top: 40px;
            font-size: 14px;
            color: #6c757d;
        }
        .btn-group-format {
            margin-bottom: 20px;
        }
        .line-item-row {
            border-bottom: 1px solid #dee2e6;
            padding-bottom: 15px;
            margin-bottom: 15px;
        }
        .line-total {
            font-weight: bold;
        }
        .thermal-format {
            width: 80mm;
            padding: 5mm;
            font-size: 10px;
        }
        .thermal-format .invoice-title {
            font-size: 16px;
            margin-bottom: 3px;
        }
        .thermal-format .invoice-header {
            padding-bottom: 10px;
            margin-bottom: 10px;
        }
        .thermal-format .invoice-table th,
        .thermal-format .invoice-table td {
            padding: 6px 8px;
            font-size: 9px;
        }
        .thermal-format .invoice-totals {
            width: 100%;
            margin-top: 10px;
        }
        .thermal-format .invoice-totals table {
            width: 100%;
        }
        .thermal-format .invoice-totals td {
            padding: 4px 6px;
        }
        .thermal-format .invoice-footer {
            margin-top: 20px;
            font-size: 8px;
        }
        .a4-format {
            width: 210mm;
            min-height: 297mm;
            padding: 20mm;
        }
        .preview-container {
            overflow: auto;
            max-height: 600px;
            border: 1px solid #dee2e6;
            padding: 15px;
            background-color: #f8f9fa;
        }
        @media (max-width: 768px) {
            .invoice-title {
                font-size: 24px;
            }
            .invoice-table th, 
            .invoice-table td {
                padding: 8px 10px;
            }
            .preview-container {
                max-height: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="container py-4">
        <div class="row">
            <div class="col-12 mb-4">
                <h1 class="text-center">Invoice Generator</h1>
                <p class="text-center text-muted">Create professional invoices and quotations</p>
            </div>
        </div>

        <div class="row">
            <!-- Form Section -->
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        Invoice Details
                    </div>
                    <div class="card-body">
                        <form id="invoiceForm">
                            <!-- Business Information -->
                            <div class="row">
                              <div class="col-6">
                                <label for="businessName" class="form-label">Business Name</label>
                                <input type="text" class="form-control" id="businessName" value="ABDULLAH SURGICAL">
                              </div>

                              <div class="col-6">
                                <label for="businessPhone" class="form-label">Business Phone</label>
                                <input type="text" class="form-control" id="businessPhone" value="923076830789">
                              </div>

                              <div class="col-6">
                                <label for="businessAddress" class="form-label">Business Address</label>
                                <textarea class="form-control" id="businessAddress" rows="2">Munir Chowk, asad market, shop #1, Gujranwala</textarea>
                              </div>
                            </div>

                                         
                            <div class="row">
                              <div class="col-6">
                                <label for="customerName" class="form-label">Customer Name</label>
                                <input type="text" class="form-control" id="customerName" value="">
                              </div>
                              <div class="col-6">
                                <label for="customerAddress" class="form-label">Customer Address</label>
                                <textarea class="form-control" id="customerAddress" rows="2"></textarea>
                              </div>
                                
                            </div>


                            <!-- Invoice Details -->
                            <div class="row mb-3 mt-2">
                                <div class="col-3">
                                    <label for="invoiceNumber" class="form-label">Invoice/Quotation #</label>
                                    <input type="text" class="form-control" id="invoiceNumber" value="INV-001">
                                </div>
                                <div class="col-3">
                                    <label for="invoiceDate" class="form-label">Date</label>
                                    <input type="date" class="form-control" id="invoiceDate">
                                </div>
                                
                                <div class="col-3" id="validUntilContainer" style="display: none;">
                                  <label for="validUntil" class="form-label">Valid Until</label>
                                  <input type="date" class="form-control" id="validUntil">
                                </div>

                                <div class="col-3 mt-4">
                                  <input type="checkbox" class="form-check-input" id="isQuotation">
                                  <label class="form-check-label" for="isQuotation">This is a quotation</label>
                                </div>
                            </div>


                            <!-- Line Items -->
                            <div class="mb-3">
                                <label class="form-label">Line Items</label>
                                <div id="lineItems">
                                    <div class="line-item-row row g-2">
                                        <div class="col-md-5">
                                            <input type="text" class="form-control" placeholder="Description" name="description" value="">
                                        </div>
                                        <div class="col-md-2">
                                            <input type="number" class="form-control" placeholder="Qty" name="quantity" min="1" value="1">
                                        </div>
                                        <div class="col-md-2">
                                            <input type="number" class="form-control" placeholder="Rate" name="rate" min="0" step="0.01" value="">
                                        </div>
                                        <div class="col-md-2">
                                            <input type="text" class="form-control line-total" placeholder="Total" readonly>
                                        </div>
                                        <div class="col-md-1">
                                            <button type="button" class="btn btn-danger btn-sm remove-line">×</button>
                                        </div>
                                    </div>
                                    
                                </div>
                                <button type="button" class="btn btn-secondary mt-2" id="addLineItem">Add Item</button>
                            </div>

                            <!-- Invoice Totals -->
                            <div class="mb-3">
                                <label class="form-label">Invoice Totals</label>
                                <div class="row mb-2">
                                    <div class="col-md-6">
                                        <label class="form-label">Subtotal</label>
                                    </div>
                                    <div class="col-md-6">
                                        <input type="text" class="form-control" id="subtotal" readonly value="0">
                                    </div>
                                </div>
                                <div class="row mb-2">
                                    <div class="col-md-6">
                                        <label class="form-label">Tax (%)</label>
                                    </div>
                                    <div class="col-md-6">
                                        <input type="number" class="form-control" id="taxPercent" min="0" step="0.01" value="0">
                                    </div>
                                </div>
                                <div class="row mb-2">
                                    <div class="col-md-6">
                                        <label class="form-label">Tax Amount</label>
                                    </div>
                                    <div class="col-md-6">
                                        <input type="text" class="form-control" id="taxAmount" readonly value="0">
                                    </div>
                                </div>
                                <div class="row mb-2">
                                    <div class="col-md-6">
                                        <label class="form-label">Discount</label>
                                    </div>
                                    <div class="col-md-6">
                                        <input type="number" class="form-control" id="discount" min="0" step="0.01" value="0">
                                    </div>
                                </div>
                                <div class="row mb-2">
                                    <div class="col-md-6">
                                        <label class="form-label">Grand Total</label>
                                    </div>
                                    <div class="col-md-6">
                                        <input type="text" class="form-control" id="grandTotal" readonly value="0">
                                    </div>
                                </div>
                            </div>

                            <div class="d-grid gap-2">
                                <button type="button" class="btn btn-primary" id="generatePreview">Update Preview</button>
                                <button type="button" class="btn btn-success" id="saveToStorage">Save to Local Storage</button>
                                <button class="btn btn-success" id="generatePDF">Generate PDF</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Preview Section -->
            <div class="col-12">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span>Invoice Preview</span>
                        <div class="btn-group btn-group-sm btn-group-format" role="group">
                            <input type="radio" class="btn-check" name="format" id="formatA4" autocomplete="off" checked>
                            <label class="btn btn-outline-primary" for="formatA4">A4</label>
                            
                            <input type="radio" class="btn-check" name="format" id="formatThermal" autocomplete="off">
                            <label class="btn btn-outline-primary" for="formatThermal">Thermal</label>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="preview-container">
                            <div class="invoice-preview a4-format" id="invoicePreview">
                                <!-- Invoice content will be generated here -->
                            </div>
                        </div>
                        
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Load data from localStorage if available
            loadFromStorage();
            
            // Set today's date as default
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('invoiceDate').value = today;
            
            // Set valid until to 7 days from now
            const nextWeek = new Date();
            nextWeek.setDate(nextWeek.getDate() + 7);
            document.getElementById('validUntil').value = nextWeek.toISOString().split('T')[0];
            
            // Toggle valid until field based on isQuotation checkbox
            document.getElementById('isQuotation').addEventListener('change', function() {
                document.getElementById('validUntilContainer').style.display = this.checked ? 'block' : 'none';
            });
            
            // Add new line item
            document.getElementById('addLineItem').addEventListener('click', function() {
                addLineItem();
            });
            
            // Remove line item
            document.addEventListener('click', function(e) {
                if (e.target && e.target.classList.contains('remove-line')) {
                    e.target.closest('.line-item-row').remove();
                    calculateTotals();
                }
            });
            
            // Calculate line totals and invoice totals when inputs change
            document.addEventListener('input', function(e) {
                if (e.target && (e.target.name === 'quantity' || e.target.name === 'rate')) {
                    calculateLineTotal(e.target);
                    calculateTotals();
                }
                
                if (e.target && (e.target.id === 'taxPercent' || e.target.id === 'discount')) {
                    calculateTotals();
                }
            });
            
            // Generate preview
            document.getElementById('generatePreview').addEventListener('click', function() {
                generatePreview();
            });
            
            // Save to localStorage
            document.getElementById('saveToStorage').addEventListener('click', function() {
                saveToStorage();
            });
            
            // Generate PDF
            document.getElementById('generatePDF').addEventListener('click', function() {
                generatePDF();
            });
            
            // Format selection
            document.querySelectorAll('input[name="format"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    updatePreviewFormat();
                });
            });
            
            // Initialize with sample data
            calculateLineTotals();
            calculateTotals();
            generatePreview();
        });
        
        function addLineItem() {
            const lineItems = document.getElementById('lineItems');
            const newItem = document.createElement('div');
            newItem.className = 'line-item-row row g-2';
            newItem.innerHTML = `
                <div class="col-md-5">
                    <input type="text" class="form-control" placeholder="Description" name="description">
                </div>
                <div class="col-md-2">
                    <input type="number" class="form-control" placeholder="Qty" name="quantity" min="1" value="1">
                </div>
                <div class="col-md-2">
                    <input type="number" class="form-control" placeholder="Rate" name="rate" min="0" step="0.01" value="0">
                </div>
                <div class="col-md-2">
                    <input type="text" class="form-control line-total" placeholder="Total" readonly>
                </div>
                <div class="col-md-1">
                    <button type="button" class="btn btn-danger btn-sm remove-line">×</button>
                </div>
            `;
            lineItems.appendChild(newItem);
        }
        
        function calculateLineTotals() {
            document.querySelectorAll('.line-item-row').forEach(row => {
                calculateLineTotal(row.querySelector('input[name="quantity"]'));
            });
        }
        
        function calculateLineTotal(input) {
            const row = input.closest('.line-item-row');
            const quantity = parseFloat(row.querySelector('input[name="quantity"]').value) || 0;
            const rate = parseFloat(row.querySelector('input[name="rate"]').value) || 0;
            const total = quantity * rate;
            row.querySelector('.line-total').value = total.toFixed(2);
        }
        
        function calculateTotals() {
            let subtotal = 0;
            
            document.querySelectorAll('.line-item-row').forEach(row => {
                const total = parseFloat(row.querySelector('.line-total').value) || 0;
                subtotal += total;
            });
            
            const taxPercent = parseFloat(document.getElementById('taxPercent').value) || 0;
            const taxAmount = subtotal * (taxPercent / 100);
            const discount = parseFloat(document.getElementById('discount').value) || 0;
            const grandTotal = subtotal + taxAmount - discount;
            
            document.getElementById('subtotal').value = subtotal.toFixed(2);
            document.getElementById('taxAmount').value = taxAmount.toFixed(2);
            document.getElementById('grandTotal').value = grandTotal.toFixed(2);
        }
        
        function generatePreview() {
            const preview = document.getElementById('invoicePreview');
            const isQuotation = document.getElementById('isQuotation').checked;
            const documentType = isQuotation ? 'QUOTATION' : 'INVOICE';
            
            // Get business details
            const businessName = document.getElementById('businessName').value || 'ABDULLAH SURGICAL';
            const businessAddress = document.getElementById('businessAddress').value || 'Munir Chowk, asad markeet, shop #1, Gujranwala';
            const businessPhone = document.getElementById('businessPhone').value || '03076830789';
            
            // Get customer details
            const customerName = document.getElementById('customerName').value || 'Customer Name';
            const customerAddress = document.getElementById('customerAddress').value || '';
            
            // Get invoice details
            const invoiceNumber = document.getElementById('invoiceNumber').value || 'INV-001';
            const invoiceDate = document.getElementById('invoiceDate').value;
            const validUntil = document.getElementById('validUntil').value;
            
            // Format date
            const formatDate = (dateString) => {
                if (!dateString) return '';
                const date = new Date(dateString);
                return date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
            };
            
            // Generate line items HTML
            let lineItemsHTML = '';
            document.querySelectorAll('.line-item-row').forEach(row => {
                const description = row.querySelector('input[name="description"]').value || '';
                const quantity = row.querySelector('input[name="quantity"]').value || '0';
                const rate = parseFloat(row.querySelector('input[name="rate"]').value || 0).toFixed(2);
                const total = parseFloat(row.querySelector('.line-total').value || 0).toFixed(2);
                
                if (description) {
                    lineItemsHTML += `
                        <tr>
                            <td>${description}</td>
                            <td>${quantity}</td>
                            <td>${rate}</td>
                            <td>${total}</td>
                        </tr>
                    `;
                }
            });
            
            // Get totals
            const subtotal = document.getElementById('subtotal').value || '0.00';
            const taxAmount = document.getElementById('taxAmount').value || '0.00';
            const discount = document.getElementById('discount').value || '0.00';
            const grandTotal = document.getElementById('grandTotal').value || '0.00';
            
            preview.innerHTML = `
                <div class="invoice-header">
                    <div class="row">
                        <div class="col-6">
                            <div class="invoice-title">${documentType}</div>
                            <div><strong>${businessName}</strong></div>
                            <div>${businessAddress.replace(/\n/g, '<br>')}</div>
                            <div>Phone: ${businessPhone}</div>
                        </div>
                        <div class="col-6 text-end">
                            <div><strong>${documentType} #:</strong> ${invoiceNumber}</div>
                            <div><strong>Date:</strong> ${formatDate(invoiceDate)}</div>
                            ${isQuotation && validUntil ? `<div><strong>Valid Until:</strong> ${formatDate(validUntil)}</div>` : ''}
                        </div>
                    </div>
                </div>
                
                <div class="row mb-4">
                    <div class="col-12">
                        <strong>TO:</strong><br>
                        ${customerName}<br>
                        ${customerAddress.replace(/\n/g, '<br>')}
                    </div>
                </div>
                
                <table class="invoice-table">
                    <thead>
                        <tr>
                            <th>DESCRIPTION</th>
                            <th>QTY</th>
                            <th>RATE</th>
                            <th>AMOUNT</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${lineItemsHTML || '<tr><td colspan="4" class="text-center">No items added</td></tr>'}
                    </tbody>
                </table>
                
                <div class="invoice-totals">
                    <table>
                        <tr>
                            <td>Sub Total</td>
                            <td>${subtotal}</td>
                        </tr>
                        <tr>
                            <td>Tax</td>
                            <td>${taxAmount}</td>
                        </tr>
                        <tr>
                            <td>Discount</td>
                            <td>${discount}</td>
                        </tr>
                        <tr>
                            <td><strong>TOTAL</strong></td>
                            <td><strong>${grandTotal}</strong></td>
                        </tr>
                    </table>
                </div>
                
                <div class="invoice-footer">
                    <p><strong>COMMENTS</strong><br>
                    Please check stock at delivery. No claim will be entertained afterward. No Return After 7 days, Loose Items, Fridge Items, damaged or unpacked items can't be returned. No return/claim will be entertained without invoice.</p>
                    
                    
                    <p class="mt-4"><em>Thank you for your continued partnership and support. Your business is greatly appreciated.</em></p>
                </div>
            `;
            
            updatePreviewFormat();
        }
        
        function updatePreviewFormat() {
            const preview = document.getElementById('invoicePreview');
            const format = document.querySelector('input[name="format"]:checked').id;
            
            // Remove all format classes
            preview.classList.remove('a4-format', 'thermal-format');
            
            // Add the selected format class
            if (format === 'formatA4') {
                preview.classList.add('a4-format');
            } else if (format === 'formatThermal') {
                preview.classList.add('thermal-format');
            }
        }
        
        function saveToStorage() {
            const formData = {
                businessName: document.getElementById('businessName').value,
                businessAddress: document.getElementById('businessAddress').value,
                businessPhone: document.getElementById('businessPhone').value,
                customerName: document.getElementById('customerName').value,
                customerAddress: document.getElementById('customerAddress').value,
                invoiceNumber: document.getElementById('invoiceNumber').value,
                invoiceDate: document.getElementById('invoiceDate').value,
                isQuotation: document.getElementById('isQuotation').checked,
                validUntil: document.getElementById('validUntil').value,
                taxPercent: document.getElementById('taxPercent').value,
                discount: document.getElementById('discount').value,
                lineItems: []
            };
            
            document.querySelectorAll('.line-item-row').forEach(row => {
                formData.lineItems.push({
                    description: row.querySelector('input[name="description"]').value,
                    quantity: row.querySelector('input[name="quantity"]').value,
                    rate: row.querySelector('input[name="rate"]').value
                });
            });
            
            localStorage.setItem('invoiceData', JSON.stringify(formData));
            alert('Invoice data saved to local storage!');
        }
        
        function loadFromStorage() {
            const savedData = localStorage.getItem('invoiceData');
            if (savedData) {
                const formData = JSON.parse(savedData);
                
                document.getElementById('businessName').value = formData.businessName || '';
                document.getElementById('businessAddress').value = formData.businessAddress || '';
                document.getElementById('businessPhone').value = formData.businessPhone || '';
                document.getElementById('customerName').value = formData.customerName || '';
                document.getElementById('customerAddress').value = formData.customerAddress || '';
                document.getElementById('invoiceNumber').value = formData.invoiceNumber || '';
                document.getElementById('invoiceDate').value = formData.invoiceDate || '';
                document.getElementById('isQuotation').checked = formData.isQuotation || false;
                document.getElementById('validUntil').value = formData.validUntil || '';
                document.getElementById('taxPercent').value = formData.taxPercent || '0';
                document.getElementById('discount').value = formData.discount || '0';
                
                // Show/hide valid until based on isQuotation
                document.getElementById('validUntilContainer').style.display = 
                    formData.isQuotation ? 'block' : 'none';
                
                // Clear existing line items
                document.getElementById('lineItems').innerHTML = '';
                
                // Add saved line items
                if (formData.lineItems && formData.lineItems.length > 0) {
                    formData.lineItems.forEach(item => {
                        addLineItem();
                        const lastRow = document.querySelector('.line-item-row:last-child');
                        lastRow.querySelector('input[name="description"]').value = item.description || '';
                        lastRow.querySelector('input[name="quantity"]').value = item.quantity || '1';
                        lastRow.querySelector('input[name="rate"]').value = item.rate || '0';
                        calculateLineTotal(lastRow.querySelector('input[name="quantity"]'));
                    });
                } else {
                    // Add at least one empty line item
                    addLineItem();
                }
                
                calculateTotals();
                generatePreview();
            }
        }
        
        function generatePDF() {
            const element = document.getElementById('invoicePreview');
            const format = document.querySelector('input[name="format"]:checked').id;
            
            // Use html2canvas to capture the invoice preview as an image
            html2canvas(element, {
                scale: 2, // Higher scale for better quality
                useCORS: true,
                logging: false,
                backgroundColor: '#ffffff'
            }).then(canvas => {
                // Convert canvas to image data
                const imgData = canvas.toDataURL('image/jpeg', 1.0);
                
                // Create PDF with the correct dimensions
                const { jsPDF } = window.jspdf;
                let pdf;
                
                if (format === 'formatA4') {
                    pdf = new jsPDF('p', 'mm', 'a4');
                } else if (format === 'formatThermal') {
                    pdf = new jsPDF('p', 'mm', [80, 200]);
                }
                
                // Calculate dimensions to fit the image to the PDF page
                const pdfWidth = pdf.internal.pageSize.getWidth();
                const pdfHeight = pdf.internal.pageSize.getHeight();
                
                // Add image to PDF
                pdf.addImage(imgData, 'JPEG', 0, 0, pdfWidth, pdfHeight);
                
                // Save the PDF
                pdf.save('invoice.pdf');
            });
        }
    </script>
</body>
</html>